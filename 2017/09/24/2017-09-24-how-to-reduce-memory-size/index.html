<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"pcjustin.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.24.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="You don’t care memory size in PC but it is small in the embedded system. This post shows a couple of simple ways to reduce the wasted memory in your code.  Use dynamic allocation Don’t use global vari">
<meta property="og:type" content="article">
<meta property="og:title" content="How to reduce the memory size of the code">
<meta property="og:url" content="https://pcjustin.github.io/2017/09/24/2017-09-24-how-to-reduce-memory-size/index.html">
<meta property="og:site_name" content="Camel Rest Area">
<meta property="og:description" content="You don’t care memory size in PC but it is small in the embedded system. This post shows a couple of simple ways to reduce the wasted memory in your code.  Use dynamic allocation Don’t use global vari">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2017-09-23T22:14:26.000Z">
<meta property="article:modified_time" content="2025-08-29T14:17:02.526Z">
<meta property="article:author" content="Justin">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://pcjustin.github.io/2017/09/24/2017-09-24-how-to-reduce-memory-size/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-tw","comments":true,"permalink":"https://pcjustin.github.io/2017/09/24/2017-09-24-how-to-reduce-memory-size/","path":"2017/09/24/2017-09-24-how-to-reduce-memory-size/","title":"How to reduce the memory size of the code"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>How to reduce the memory size of the code | Camel Rest Area</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Camel Rest Area</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-dynamic-allocation"><span class="nav-number">1.</span> <span class="nav-text">Use dynamic allocation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Don%E2%80%99t-use-global-variable"><span class="nav-number">2.</span> <span class="nav-text">Don’t use global variable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Refactoring-your-code"><span class="nav-number">3.</span> <span class="nav-text">Refactoring your code</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-calculate-memory-size"><span class="nav-number">4.</span> <span class="nav-text">How to calculate memory size</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#stack-1"><span class="nav-number">4.1.</span> <span class="nav-text">stack [1]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#heap-1"><span class="nav-number">4.2.</span> <span class="nav-text">heap [1]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#What-is-bss-and-data"><span class="nav-number">4.3.</span> <span class="nav-text">What is .bss and .data</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#bss-1"><span class="nav-number">4.3.1.</span> <span class="nav-text">.bss [1]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#data-1"><span class="nav-number">4.3.2.</span> <span class="nav-text">.data [1]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#text-1"><span class="nav-number">4.3.3.</span> <span class="nav-text">.text [1]</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Justin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-tw">
    <link itemprop="mainEntityOfPage" href="https://pcjustin.github.io/2017/09/24/2017-09-24-how-to-reduce-memory-size/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Justin">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Camel Rest Area">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="How to reduce the memory size of the code | Camel Rest Area">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          How to reduce the memory size of the code
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-09-24 06:14:26" itemprop="dateCreated datePublished" datetime="2017-09-24T06:14:26+08:00">2017-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-08-29 22:17:02" itemprop="dateModified" datetime="2025-08-29T22:17:02+08:00">2025-08-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>You don’t care memory size in PC but it is small in the embedded system. This post shows a couple of simple ways to reduce the wasted memory in your code.</p>
<ul>
<li>Use dynamic allocation</li>
<li>Don’t use global variable</li>
<li>Refactoring your code</li>
<li>How to calculate memory size</li>
</ul>
<hr>
<h2 id="Use-dynamic-allocation"><a href="#Use-dynamic-allocation" class="headerlink" title="Use dynamic allocation"></a>Use dynamic allocation</h2><p>Static variables use many memory sizes until the program exits. You should use dynamic allocation if you don’t use as the same as memory each time or you don’t use the variables again.</p>
<h2 id="Don’t-use-global-variable"><a href="#Don’t-use-global-variable" class="headerlink" title="Don’t use global variable"></a>Don’t use global variable</h2><p>Compare the memory size with global variable and local variable. global variable use more memory size because the variable alives when the program begins.</p>
<p>global.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> size[<span class="number">10000</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(size, <span class="number">0x0</span>, <span class="keyword">sizeof</span>(size));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ size global</span><br><span class="line">__TEXT	__DATA</span><br><span class="line"><span class="number">4096</span>	<span class="number">40960</span></span><br></pre></td></tr></table></figure>
<p>local.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size[<span class="number">10000</span>];</span><br><span class="line">    <span class="built_in">memset</span>(size, <span class="number">0x0</span>, <span class="keyword">sizeof</span>(size));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">$ size local</span><br><span class="line">__TEXT	__DATA</span><br><span class="line"><span class="number">4096</span>	<span class="number">4096</span></span><br></pre></td></tr></table></figure>
<h2 id="Refactoring-your-code"><a href="#Refactoring-your-code" class="headerlink" title="Refactoring your code"></a>Refactoring your code</h2><p>You should refactor your code many times. You can find out many code that can use as the same as the function and variable.</p>
<h2 id="How-to-calculate-memory-size"><a href="#How-to-calculate-memory-size" class="headerlink" title="How to calculate memory size"></a>How to calculate memory size</h2><p>Let’s talking more details about stack and heap and something else.</p>
<ul>
<li>What is stack</li>
<li>What is heap</li>
<li>What is .bss and .data and .text</li>
</ul>
<h3 id="stack-1"><a href="#stack-1" class="headerlink" title="stack [1]"></a>stack [<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Data_segment">1</a>]</h3><p>The stack area contains the program stack, a LIFO structure, typically located in the higher parts of memory. When call function, local variable will put into stack until the function exits. If you write a recursive function, it use many stacks.</p>
<p>Please following the code that use 40 bytes until function ‘run1’ exits.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">run2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    u16 num[<span class="number">10</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">run1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    u16 num[<span class="number">10</span>];</span><br><span class="line">    run2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="heap-1"><a href="#heap-1" class="headerlink" title="heap [1]"></a>heap [<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Data_segment">1</a>]</h3><p>The heap area commonly begins at the end of the .bss and .data segments and grows to larger addresses from there. The heap area is managed by malloc, calloc, realloc, and free, which may use the brk and sbrk system calls to adjust its size</p>
<p>Please following the code that use 10 bytes until free the variable ‘str’.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">run3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *str;</span><br><span class="line">    str = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(u8) * <span class="number">10</span>);</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="built_in">free</span>(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="What-is-bss-and-data"><a href="#What-is-bss-and-data" class="headerlink" title="What is .bss and .data"></a>What is .bss and .data</h3><h4 id="bss-1"><a href="#bss-1" class="headerlink" title=".bss [1]"></a>.bss [<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Data_segment">1</a>]</h4><p>The BSS segment, also known as uninitialized data, is usually adjacent to the data segment. The BSS segment contains all global variables and static variables that are initialized to zero or do not have explicit initialization in source code. </p>
<h4 id="data-1"><a href="#data-1" class="headerlink" title=".data [1]"></a>.data [<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Data_segment">1</a>]</h4><p>The .data segment contains any global or static variables which have a pre-defined value and can be modified.</p>
<h4 id="text-1"><a href="#text-1" class="headerlink" title=".text [1]"></a>.text [<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Data_segment">1</a>]</h4><p>The code segment, also known as a text segment or simply as text, is where a portion of an object file or the corresponding section of the program’s virtual address space that contains executable instructions is stored and is generally read-only and fixed size.</p>
<hr>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2017/09/24/2017-09-17-gcc-define/" rel="prev" title="GCC defines">
                  <i class="fa fa-angle-left"></i> GCC defines
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2017/09/24/2017-09-22-how-to-use-arm-none-eabi-gcc-on-cmake/" rel="next" title="How to use arm-none-eabi-gcc on CMake">
                  How to use arm-none-eabi-gcc on CMake <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Justin</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
